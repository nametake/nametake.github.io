<!DOCTYPE html>
<html lang="ja">

<head>
  <title>
  TypeScript&#43;React&#43;Reduxチュートリアル · nametake.dev
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="nametake">
<meta name="description" content="普段は Go でサーバサイドのコードを書いているが、TypeScript&#43;React&#43;Redux を勉強する機会があった。 その際、巷のチュートリアル">
<meta name="keywords" content="blog,developer,personal">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="TypeScript&#43;React&#43;Reduxチュートリアル">
  <meta name="twitter:description" content="普段は Go でサーバサイドのコードを書いているが、TypeScript&#43;React&#43;Redux を勉強する機会があった。 その際、巷のチュートリアル">

<meta property="og:url" content="https://nametake.github.io/posts/2018/12/05/typescript-react-redux-tutorial/">
  <meta property="og:site_name" content="nametake.dev">
  <meta property="og:title" content="TypeScript&#43;React&#43;Reduxチュートリアル">
  <meta property="og:description" content="普段は Go でサーバサイドのコードを書いているが、TypeScript&#43;React&#43;Redux を勉強する機会があった。 その際、巷のチュートリアル">
  <meta property="og:locale" content="ja">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2018-12-05T11:08:00+09:00">
    <meta property="article:modified_time" content="2018-12-05T11:08:00+09:00">
    <meta property="article:tag" content="TypeScript">
    <meta property="article:tag" content="React">
    <meta property="article:tag" content="Redux">




<link rel="canonical" href="https://nametake.github.io/posts/2018/12/05/typescript-react-redux-tutorial/">


<link rel="preload" href="../../../../../fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="../../../../../fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="../../../../../fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="../../../../../css/coder.min.38c4552ac40f9ae3408bad40358f654ebd8804412fe74ed56f2d6c8a7af82dd3.css" integrity="sha256-OMRVKsQPmuNAi61ANY9lTr2IBEEv507Vby1sinr4LdM=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="../../../../../css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 
  
    
    <link rel="stylesheet" href="../../../../../css/noto&#43;sans&#43;jp.min.ed4b9470a6e014d7c178379b142a1dc1850e399398dc9ce15b1e3bba8368c55f.css" integrity="sha256-7UuUcKbgFNfBeDebFCodwYUOOZOY3JzhWx47uoNoxV8=" crossorigin="anonymous" media="screen" />
  



  
  
    
    <link rel="stylesheet" href="../../../../../scss/custom.min.058882cb3caba673503d9e9323f469b039fbd5f4a6e1f421464d8311ae68be80.css" integrity="sha256-BYiCyzyrpnNQPZ6TI/RpsDn71fSm4fQhRk2DEa5ovoA=" crossorigin="anonymous" media="screen" />
  



<link rel="icon" type="image/svg+xml" href="../../../../../images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="../../../../../images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../../../images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="../../../../../images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="../../../../../images/apple-touch-icon.png">

<link rel="manifest" href="../../../../../site.webmanifest">
<link rel="mask-icon" href="../../../../../images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://nametake.github.io/">
      nametake.dev
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="../../../../../about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="../../../../../posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="../../../../../tags/">Tags</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://nametake.github.io/posts/2018/12/05/typescript-react-redux-tutorial/">
              TypeScript&#43;React&#43;Reduxチュートリアル
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2018-12-05T11:08:00&#43;09:00">
                2018/12/05
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              12-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="../../../../../tags/typescript/">TypeScript</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="../../../../../tags/react/">React</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="../../../../../tags/redux/">Redux</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p>普段は Go でサーバサイドのコードを書いているが、TypeScript+React+Redux を勉強する機会があった。</p>
<p>その際、巷のチュートリアルやサンプルコードは型で縛っているものが少なく、理解にかなり苦労したので自分なりの Todo アプリケーションを作るチュートリアルを書いておく。</p>
<p>このチュートリアルは以下のことを意識して書いた。</p>
<ul>
<li>引数や返り値は型で縛る
<ul>
<li>データフローの理解を重視する</li>
</ul>
</li>
<li>外部ライブラリは以下の 3 つしか import しない
<ul>
<li>react</li>
<li>redux</li>
<li>react-redux</li>
</ul>
</li>
<li>標準の設計になるべく則る</li>
</ul>
<p>また、この記事では以下のことについては深く言及はしない。</p>
<ul>
<li>nodeのツールのエコシステム</li>
<li>TypeScript の記法</li>
<li>JSX の記法</li>
<li>React+Redux の概念</li>
</ul>
<h3 id="プロジェクトの準備">
  プロジェクトの準備
  <a class="heading-link" href="#%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%81%ae%e6%ba%96%e5%82%99">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>まずはプロジェクトを準備。</p>
<p>node と yarn は入っている前提ですすめる。</p>
<p>Facebook が公式で用意しているアプリケーション作成ツールを使用してプロジェクトテンプレートを作成。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>npx create-react-app todo-app --scripts-version=react-scripts-ts
</span></span></code></pre></div><p>次にプロジェクトのディレクトリに移動して以下のツールをインストール。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>cd todo-app
</span></span><span style="display:flex;"><span>yarn add redux react-redux
</span></span><span style="display:flex;"><span>yarn add -D @types/redux @types/react-redux
</span></span></code></pre></div><p>@types がついているパッケージは、<code>/</code>以下のパッケージの型情報が記述されているパッケージ。開発時しか使用しないので<code>-D</code>オプションを付けてインストールする。</p>
<p>以下のコマンドでローカルサーバが立ち上がり、ブラウザに画面が表示されれば問題ない。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>yarn start
</span></span></code></pre></div><p>チュートリアルのコードは作成されたプロジェクト内部の src ディレクトリに記述する。</p>
<h3 id="component-の実装">
  Component の実装
  <a class="heading-link" href="#component-%e3%81%ae%e5%ae%9f%e8%a3%85">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>何はともあれ何かが表示されてないとモチベーションが上がらないのでブラウザに見た目を表示させる。</p>
<p>以下のコードを TodoComponent.tsx として src 以下に記述する。JSX 記法が含まれるファイルは tsx 拡張子にする。</p>
<p>以下のコードは React と TypeScript の要素しか出てきていない。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// TodoComponent.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">React</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;react&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IProps</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">todos</span>: <span style="color:#66d9ef">string</span>[];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">onClickAddButton</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">todo</span>: <span style="color:#66d9ef">string</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">void</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IState</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* tslint:disable:jsx-no-lambda */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">class</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">Component</span>&lt;<span style="color:#f92672">IProps</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#a6e22e">IState</span>&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">constructor</span>(<span style="color:#a6e22e">props</span>: <span style="color:#66d9ef">IProps</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">super</span>(<span style="color:#a6e22e">props</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Componentのstateの初期化
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">render() {</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">todos</span> } <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">text</span> } <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span>{{ <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;500px&#39;</span>, <span style="color:#a6e22e">margin</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;0 auto&#39;</span> }}&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">h1</span>&gt;<span style="color:#a6e22e">TODO</span> <span style="color:#a6e22e">LIST</span>&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">text</span>} <span style="color:#a6e22e">onChange</span><span style="color:#f92672">=</span>{<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onTextChange</span>} /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onClickAddButton</span>}&gt;<span style="color:#a6e22e">Add</span> <span style="color:#a6e22e">Todo</span>&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex;"><span>          {<span style="color:#a6e22e">todos</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">todo</span>, <span style="color:#a6e22e">i</span>) <span style="color:#f92672">=&gt;</span> (
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">key</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">i</span>}&gt;{<span style="color:#a6e22e">todo</span>}&lt;/<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex;"><span>          ))}
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// テキストが更新されたときのイベント関数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">onTextChange</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">e</span>: <span style="color:#66d9ef">React.ChangeEvent</span>&lt;<span style="color:#f92672">HTMLInputElement</span>&gt;) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// text inputに文字が入力されるたびに入力内容をinputに反映させている
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setState</span>({ <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">e.currentTarget.value</span> });
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ボタンがクリックされたときのイベント関数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">onClickAddButton</span> <span style="color:#f92672">=</span> () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">onClickAddButton</span> } <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">text</span> } <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">onClickAddButton</span>(<span style="color:#a6e22e">text</span>);
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>作成した TodoComponent を表示させるために、元からあった App.tsx を以下のように書き換える。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// App.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">React</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;react&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">TodoComponent</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;./TodoComponent&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* tslint:disable:no-console */</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* tslint:disable:jsx-no-lambda */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">App</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">Component</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">render() {</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">TodoComponent</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">todos</span><span style="color:#f92672">=</span>{[<span style="color:#e6db74">&#39;foo&#39;</span>, <span style="color:#e6db74">&#39;bar&#39;</span>]}
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">onClickAddButton</span><span style="color:#f92672">=</span>{(<span style="color:#a6e22e">todo</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">todo</span>);
</span></span><span style="display:flex;"><span>          }}
</span></span><span style="display:flex;"><span>        /&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">App</span>;
</span></span></code></pre></div><p>画面を確認するとフォームとAdd Todoボタン、fooとbarがリストで表示されているはず。この状態でフォームに文字を入力した状態で Add TODO ボタンをクリックすると console に入力したテキストが表示される。まだリストに追加はされない。</p>
<p>ここで定義した <code>TodoComponent</code> は&quot;Presentational Component&quot;と呼ばれるもので、見た目を表現するもの。 この Component は Redux やその他ライブラリとは完全に切り離されたものになる。</p>
<p><code>TodoComponent</code> に渡している IProps は React における props を明示的に型として定義したもの。React における props は親の Component から渡されてくる情報のこと。型を定義しておくことでこの Component には<code>todos</code>という string のリストと、string を受け取って void を返す関数の入った props が渡ってくることが明確になる。</p>
<p>IState は React における state を明示的に型として定義したものになる。React における state は<strong>この Component の状態(主に UI)を表す</strong>。 型を定義することで、この Component は<code>text</code>という文字列を状態として持つことを明示する。</p>
<p>onTextChangeやonClickAddButtonのようなコールバック関数はクラスのメンバとして定義する。こうすることで描画のたびに関数が生成されるのを防ぐ。</p>
<p>は補足として、 <code>render()</code> に含まれているリストの処理で<code>key</code>にリストのindexを使っているのはあまりいい方法ではない。 Reactではリストの描画の際、key属性を見てその要素が追加されたのか削除されたのかを判別している。そのため、keyはそのリストで一意になる値を使うほうが良い。しかし、そこまでカバーしようとするとTodoオブジェクトを定義する必要があり実装の範囲が広がるため、今回はそこまでしていない。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span>          {<span style="color:#a6e22e">todos</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">todo</span>, <span style="color:#a6e22e">i</span>) <span style="color:#f92672">=&gt;</span> (
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">key</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">i</span>}&gt;{<span style="color:#a6e22e">todo</span>}&lt;/<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex;"><span>          ))}
</span></span></code></pre></div><h4 id="react-のみでtodoアプリケーションを作る場合">
  React のみでTodoアプリケーションを作る場合
  <a class="heading-link" href="#react-%e3%81%ae%e3%81%bf%e3%81%a7todo%e3%82%a2%e3%83%97%e3%83%aa%e3%82%b1%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e3%82%92%e4%bd%9c%e3%82%8b%e5%a0%b4%e5%90%88">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>Redux はアプリケーションの全体で使う状態( Component の状態ではなく)を外出しすることで、アプリケーションの状態とUIを分離するためのフレームワーク。</p>
<p>今回は Redux のチュートリアルのため、<code>todos</code> は外から渡される props に配置したが、この Component の状態( state )とすることで、React のみで完結させることができる。</p>
<p>以下のように書き換えることで React のみで Todo リストを作成できる。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// TodoComponent.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">React</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;react&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IProps</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">onClickAddButton</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">todo</span>: <span style="color:#66d9ef">string</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">void</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IState</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">todos</span>: <span style="color:#66d9ef">string</span>[];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* tslint:disable:jsx-no-lambda */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">class</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">Component</span>&lt;<span style="color:#f92672">IProps</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#a6e22e">IState</span>&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">constructor</span>(<span style="color:#a6e22e">props</span>: <span style="color:#66d9ef">IProps</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">super</span>(<span style="color:#a6e22e">props</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Componentのstateの初期化
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">todos</span><span style="color:#f92672">:</span> []
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">render() {</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">todos</span>, <span style="color:#a6e22e">text</span> } <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span>{{ <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;500px&#39;</span>, <span style="color:#a6e22e">margin</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;0 auto&#39;</span> }}&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">h1</span>&gt;<span style="color:#a6e22e">TODO</span> <span style="color:#a6e22e">LIST</span>&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">text</span>} <span style="color:#a6e22e">onChange</span><span style="color:#f92672">=</span>{<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onTextChange</span>} /&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onClickAddButton</span>}&gt;<span style="color:#a6e22e">Add</span> <span style="color:#a6e22e">Todo</span>&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex;"><span>          {<span style="color:#a6e22e">todos</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">todo</span>, <span style="color:#a6e22e">i</span>) <span style="color:#f92672">=&gt;</span> (
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">key</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">i</span>}&gt;{<span style="color:#a6e22e">todo</span>}&lt;/<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex;"><span>          ))}
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// テキストが更新されたときのイベント関数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">onTextChange</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">e</span>: <span style="color:#66d9ef">React.ChangeEvent</span>&lt;<span style="color:#f92672">HTMLInputElement</span>&gt;) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// text inputに文字が入力されるたびに入力内容をinputに反映させている
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setState</span>({ <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">e.currentTarget.value</span> });
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ボタンがクリックされたときのイベント関数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">onClickAddButton</span> <span style="color:#f92672">=</span> () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">text</span>, <span style="color:#a6e22e">todos</span> } <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setState</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">todos</span>: <span style="color:#66d9ef">todos.concat</span>([<span style="color:#a6e22e">text</span>])
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>IProps</code>の<code>todos</code>がなくなったので App.tsx は以下のように書き換える。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// App.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">React</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;react&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">TodoComponent</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;./TodoComponent&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* tslint:disable:no-console */</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* tslint:disable:jsx-no-lambda */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">App</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">Component</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">render() {</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">TodoComponent</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">onClickAddButton</span><span style="color:#f92672">=</span>{(<span style="color:#a6e22e">todo</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">todo</span>);
</span></span><span style="display:flex;"><span>          }}
</span></span><span style="display:flex;"><span>        /&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">App</span>;
</span></span></code></pre></div><p>コンポーネントがネストしておらず、データフローが複雑ではないならこれでこれでも十分ではある。</p>
<!-- textlint-disable ja-technical-writing/ja-no-weak-phrase -->
<p>このあたりのことは Redux の作者でもある、Dan Abramov 氏が<a href="https://medium.com/@dan_abramov/you-might-not-need-redux-be46360cf367"  class="external-link" target="_blank" rel="noopener">You Might Not Need Redux</a>という記事を書いているので一読しておくと良いかもしれない。</p>
<!-- textlint-enable -->
<p>とは言うものの、この記事は React+Redux のチュートリアル記事なので、Redux を使う方向で進める。</p>
<h3 id="store-の-state-の定義">
  Store の State の定義
  <a class="heading-link" href="#store-%e3%81%ae-state-%e3%81%ae%e5%ae%9a%e7%be%a9">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>次に Store の State を定義する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#75715e">// store.ts
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Storeが持つTodoにの状態を定義
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ITodoState</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">todos</span>: <span style="color:#66d9ef">string</span>[];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 全てのStateを集約したStateを定義
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IRootState</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">todoState</span>: <span style="color:#66d9ef">ITodoState</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Store とは Redux における役割の1つ。<a href="https://redux.js.org/api/store"  class="external-link" target="_blank" rel="noopener">公式ドキュメント</a>にあるとおり、そのアプリケーションにおける全ての状態(State)を持つ。この State は後述する Action-&gt;Reducer 経由でしか更新されない。</p>
<p>ちなみに上記のコードにはまだ Store は定義されておらず、Store が持つ State しか定義されいない。また、少し冗長だが、いくつか State が出てくることを想定して、<code>IRootState</code> を用意している。これぐらいのアプリケーションなら <code>ITodoState</code> だけでも十分ではある。</p>
<p>少し厄介だが、ここにおける &ldquo;State&rdquo; は先程出てきた &ldquo;Component の state&rdquo; とは<strong>全くの別物</strong>。Redux における State はアプリケーション全体の状態を表し、React の state はその Component の状態を表している。</p>
<h3 id="action-の追加">
  Action の追加
  <a class="heading-link" href="#action-%e3%81%ae%e8%bf%bd%e5%8a%a0">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>次に&quot;Add Todo&quot;ボタンを押したときに発火される Action を定義する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#75715e">// action.ts
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Action</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;redux&#39;</span>; <span style="color:#75715e">// reduxで定義されているAction interfaceだけimport
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// reduxのActionとして判別するための識別子をenumとして定義
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">enum</span> <span style="color:#a6e22e">TodoActionType</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ADD_TODO</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ADD_TODO&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Todoを追加するActionとして、Actionを継承したinterfaceを定義
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 追加するPayloadの情報も同時に持つ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IAddTodoAction</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Action</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">TodoActionType</span>.<span style="color:#a6e22e">ADD_TODO</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">todo</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Actionを表現したinterfaceを一つの型として取り扱うためにTodoAction型を定義
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">TodoAction</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">IAddTodoAction</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 定義したActionのinterfaceを作成するCreatorのinterfaceを定義
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ITodoActionCreator</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">addTodoAction</span>(<span style="color:#a6e22e">todo</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#a6e22e">IAddTodoAction</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 定義したCreatorの実装を定義(exportをつけてないので外からは見えない)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TodoActionCreator</span> <span style="color:#66d9ef">implements</span> <span style="color:#a6e22e">ITodoActionCreator</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">addTodoAction</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">todo</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#a6e22e">IAddTodoAction</span> <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">todo</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">TodoActionType</span>.<span style="color:#a6e22e">ADD_TODO</span>
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Creatorのインスタンスを作成
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">todoActionCreator</span>: <span style="color:#66d9ef">ITodoActionCreator</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TodoActionCreator</span>();
</span></span></code></pre></div><p>少し冗長だが書いてあることはシンプルで、Action の型の定義とそれを作成する Creator を作成している。</p>
<p><code>redux</code> パッケージの <code>Action</code> の interface 定義には <code>type</code> しか定義されていないが、 Action と一緒にデータを渡したいため<a href="https://github.com/redux-utilities/flux-standard-action"  class="external-link" target="_blank" rel="noopener">Action のコーディング規約</a>に則って<code>payload</code>を付与している。このコーディング規約自体は非公式だが、これに則っているライブラリも多いためこのチュートリアルではそれに従う。</p>
<p>以下の記述は TodoAction 型を作成するためのもの。今後 Action の interface が増えたときに<code>|</code>記述を使って TodoAction と一致する型を増やすことができる。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">TodoAction</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">IAddTodoAction</span>;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#75715e">// TodoActionはITodoActionかIDeleteTodoActionのどちらかを受け取れる
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">TodoAction</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">IAddTodoAction</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">IDeleteTodoAction</span>;
</span></span></code></pre></div><h3 id="reducer-の追加">
  Reducer の追加
  <a class="heading-link" href="#reducer-%e3%81%ae%e8%bf%bd%e5%8a%a0">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Action が発火したあと、その Action に応じて Store の State を更新する Reducer を作成する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#75715e">// reducer.ts
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">combineReducers</span>, <span style="color:#a6e22e">Reducer</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;redux&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">IAddTodoAction</span>, <span style="color:#a6e22e">TodoAction</span>, <span style="color:#a6e22e">TodoActionType</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;./action&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">IRootState</span>, <span style="color:#a6e22e">ITodoState</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;./store&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ITodoStateの初期データを作成
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">initTodoState</span>: <span style="color:#66d9ef">ITodoState</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">todos</span><span style="color:#f92672">:</span> []
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Todoで発生するactionに対応してReduxのstateを返すReducerを作成
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">todoReducer</span>: <span style="color:#66d9ef">Reducer</span>&lt;<span style="color:#f92672">ITodoState</span>&gt; <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">state</span>: <span style="color:#66d9ef">ITodoState</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">initTodoState</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">action</span>: <span style="color:#66d9ef">TodoAction</span>
</span></span><span style="display:flex;"><span>)<span style="color:#f92672">:</span> <span style="color:#a6e22e">ITodoState</span> <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 関数の引数として渡されてきたactionのtypeを見てReduxのstateを返す
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">action</span>.<span style="color:#66d9ef">type</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">TodoActionType</span>.<span style="color:#a6e22e">ADD_TODO</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// ADD_TODOの場合はactionのpayloadに新しいtodoが詰められているので
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">// それを取り出してtodosに追加して新しいstateとして返す
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">addTodoAction</span>: <span style="color:#66d9ef">IAddTodoAction</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">action</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        ...<span style="color:#a6e22e">state</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">todos</span>: <span style="color:#66d9ef">state.todos.concat</span>([<span style="color:#a6e22e">addTodoAction</span>.<span style="color:#a6e22e">payload</span>.<span style="color:#a6e22e">todo</span>])
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">state</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 全てを集約したReducerを作成
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reducer</span>: <span style="color:#66d9ef">Reducer</span>&lt;<span style="color:#f92672">IRootState</span>&gt; <span style="color:#f92672">=</span> <span style="color:#a6e22e">combineReducers</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">todoState</span>: <span style="color:#66d9ef">todoReducer</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">reducer</span>;
</span></span></code></pre></div><p>action.ts に定義した <code>TodoAction</code> を受け取り、store.ts に定義した <code>ITodoState</code> 型を指定した Reducer を返す <code>todoReducer</code> を作成している。</p>
<p><code>todoReducer</code> では <code>TodoActionType</code> が <code>ADD_TODO</code> だったときに、Actionの <code>payload</code> の <code>todo</code> を <code>state.todos</code> に新しく追加している。</p>
<p>ここで気をつけなくてはいけないのは、<strong>Reducer が返す State は必ず新しいオブジェクトにする</strong>という点。</p>
<p>React+Redux では <strong>Reducer が返す State と現在の State を比較して差分がある時</strong>に UI を更新する。そのため Reducer のなかで State を直接操作してしまうと Reducer の返り値との差分がなくなり、正常に UI が更新されなくなってしまう。</p>
<p>今回の場合だと「 Action の <code>payload.todo</code> を <code>state.todos</code> に追加する」という点から <code>state.todos.push(payload.todo)</code> としてしまうと UI が正常に更新されないため気をつける。</p>
<h3 id="reducer-を使って-store-の作成">
  Reducer を使って Store の作成
  <a class="heading-link" href="#reducer-%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6-store-%e3%81%ae%e4%bd%9c%e6%88%90">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>reducer.ts に定義した<code>reducer</code>を使用して、store.ts に<code>store</code>を以下のように追記して定義する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#75715e">// store.ts
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Action</span>, <span style="color:#a6e22e">createStore</span>, <span style="color:#a6e22e">Store</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;redux&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">reducer</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;./reducer&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Storeが持つTodoにの状態を定義
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ITodoState</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">todos</span>: <span style="color:#66d9ef">string</span>[];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 全てのStateを集約したStateを定義
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IRootState</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">todoState</span>: <span style="color:#66d9ef">ITodoState</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// importしたreducerを渡してstoreを作成
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">store</span>: <span style="color:#66d9ef">Store</span>&lt;<span style="color:#f92672">ITodoState</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#a6e22e">Action</span>&gt; <span style="color:#f92672">=</span> <span style="color:#a6e22e">createStore</span>(<span style="color:#a6e22e">reducer</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">store</span>;
</span></span></code></pre></div><p>上記の定義をすることで、 Action が発火されるとそれに対応した Reducer が起動して Store の State が更新されるようになる。</p>
<p>しかし、まだ Action の発火部分と Store が更新されたときの描画については記述されていないので、それを行う Container というものを作成する。</p>
<h3 id="container-を作成">
  Container を作成
  <a class="heading-link" href="#container-%e3%82%92%e4%bd%9c%e6%88%90">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>最後に、最初に定義した Component と Redux の世界をつなぐための Container を作成する。</p>
<p>以下のように TodoContainer.tsx を作成する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// TodoContainer.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">React</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;react&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">connect</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;react-redux&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Action</span>, <span style="color:#a6e22e">Dispatch</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;redux&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">todoActionCreator</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;./action&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">IRootState</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;./store&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">TodoComponent</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;./TodoComponent&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ReduxのStoreをReactのContainerのPropsに変換するinterfaceを定義
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IStateToProps</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">todos</span>: <span style="color:#66d9ef">string</span>[];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ReduxのDispatchをPropsに変換するinterfaceを定義
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// メンバにはどのアクションを実行するのかを定義する
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IDispatchToProps</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">addTodo</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">todo</span>: <span style="color:#66d9ef">string</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">void</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// IStateToPropsとIDispatchToPropsの複合型を定義
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">IProps</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">IStateToProps</span> <span style="color:#f92672">&amp;</span> <span style="color:#a6e22e">IDispatchToProps</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// IPropsを受け取るContainerを定義
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Stateは持たないので空の定義を渡す
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">/* tslint:disable:jsx-no-lambda */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TodoContainer</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">Component</span>&lt;<span style="color:#f92672">IProps</span><span style="color:#960050;background-color:#1e0010">,</span> {}&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">constructor</span>(<span style="color:#a6e22e">props</span>: <span style="color:#66d9ef">IProps</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">super</span>(<span style="color:#a6e22e">props</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">render</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">JSX</span>.<span style="color:#a6e22e">Element</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TodoComponentにpropsの値を詰めて返す
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">todos</span> } <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">TodoComponent</span> <span style="color:#a6e22e">todos</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">todos</span>} <span style="color:#a6e22e">onClickAddButton</span><span style="color:#f92672">=</span>{<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onClickAddButton</span>} /&gt;
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// TodoComponentにわたすコールバック関数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">onClickAddButton</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">todo</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">addTodo</span> } <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">addTodo</span>(<span style="color:#a6e22e">todo</span>);
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Storeが更新されたときに送られてくるStateを受け取り、
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// IStateToPropsに変換して返す関数を定義
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mapStateToProps</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">state</span>: <span style="color:#66d9ef">IRootState</span>)<span style="color:#f92672">:</span> <span style="color:#a6e22e">IStateToProps</span> <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">todoState</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">state</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">todos</span>: <span style="color:#66d9ef">todoState.todos</span>
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Dispatchを受け取り、IDispatchToPropsの関数でどのアクションをDispatchするのかを定義する
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mapDispatchToProps</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">dispatch</span>: <span style="color:#66d9ef">Dispatch</span>&lt;<span style="color:#f92672">Action</span>&gt;)<span style="color:#f92672">:</span> <span style="color:#a6e22e">IDispatchToProps</span> <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">addTodo</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">todo</span>: <span style="color:#66d9ef">string</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">dispatch</span>(<span style="color:#a6e22e">todoActionCreator</span>.<span style="color:#a6e22e">addTodoAction</span>(<span style="color:#a6e22e">todo</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Storeが更新されたときの挙動が詰められたIStatePropsと、
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Storeを更新するためのメソッドが詰められたIDispatchToPropsをTodoContainerと繋ぎこむ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">connect</span>&lt;<span style="color:#f92672">IStateToProps</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#a6e22e">IDispatchToProps</span>&gt;(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mapStateToProps</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mapDispatchToProps</span>
</span></span><span style="display:flex;"><span>)(<span style="color:#a6e22e">TodoContainer</span>);
</span></span></code></pre></div><p>次に App.tsx を以下のように変更する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// App.tsx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">React</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;react&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Provider</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;react-redux&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">store</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;./store&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">TodoContainer</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;./TodoContainer&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">App</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">Component</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">render() {</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">Provider</span> <span style="color:#a6e22e">store</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">store</span>}&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">TodoContainer</span> /&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">Provider</span>&gt;
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">App</span>;
</span></span></code></pre></div><p>上記まで書くとフォームに Add Todo ボタンを押したときに TODO が追加されるようなる。</p>
<p><code>TodoContainer</code> は、 <code>TodoComponent</code> が &ldquo;Presentational Component&rdquo; と呼ばれるのに対して、 &ldquo;Container Component&rdquo; と呼ばれる。</p>
<p>&ldquo;Container Component&rdquo; は &ldquo;Presentational Component&rdquo; にデータやコールバック関数を与える役割を持つ。また、基本的には UI を持たない。通常 Component が描画をするための <code>render()</code> メソッドは &ldquo;Presentational Component&rdquo; の組み立てと、それらにデータとコールバックを与えるのが役割になる。</p>
<p>Containerで で一番理解しづらいのは以下の部分になる。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#75715e">// Storeが更新されたときに送られてくるStateを受け取り、
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// IStateToPropsに変換して返す関数を定義
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mapStateToProps</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">state</span>: <span style="color:#66d9ef">IRootState</span>)<span style="color:#f92672">:</span> <span style="color:#a6e22e">IStateToProps</span> <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">todoState</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">state</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">todos</span>: <span style="color:#66d9ef">todoState.todos</span>
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Dispatchを受け取り、IDispatchToPropsの関数でどのアクションをDispatchするのかを定義する
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mapDispatchToProps</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">dispatch</span>: <span style="color:#66d9ef">Dispatch</span>&lt;<span style="color:#f92672">Action</span>&gt;)<span style="color:#f92672">:</span> <span style="color:#a6e22e">IDispatchToProps</span> <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">addTodo</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">todo</span>: <span style="color:#66d9ef">string</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">dispatch</span>(<span style="color:#a6e22e">todoActionCreator</span>.<span style="color:#a6e22e">addTodoAction</span>(<span style="color:#a6e22e">todo</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Storeが更新されたときの挙動が詰められたIStatePropsと、
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Storeを更新するためのメソッドが詰められたIDispatchToPropsをTodoContainerと繋ぎこむ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">connect</span>&lt;<span style="color:#f92672">IStateToProps</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#a6e22e">IDispatchToProps</span>&gt;(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mapStateToProps</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mapDispatchToProps</span>
</span></span><span style="display:flex;"><span>)(<span style="color:#a6e22e">TodoContainer</span>);
</span></span></code></pre></div><p>この部分を説明するにあたって、Store の機能を説明する必要がある。</p>
<p>Storeは以下の2つの機能を持っていいる。</p>
<ul>
<li>State が更新されたときに更新された状態を通知する機能 (subscribe)</li>
<li>Store に Action を伝えて状態を更新する機能 (dispatch)</li>
</ul>
<p>これらは Redux の概念のため React とは特に関係のない。その関係のない Redux の Store と、描画のための React の世界をつなげるために、 <code>react-redux</code> の <code>connect</code> 関数を使う。</p>
<p><code>connect</code> の1つ目の引数には、「Store の subscribe が発火したときに、更新された State をどのように props に割り当てるのか」という記述がされた <code>mapStateToProps</code> を渡している。
2つ目の引数には「 Action を伝える dispatch を実行するメソッドをどのように props に割り当てるのか」という記述がされた <code>mapDispatchToProps</code> を渡している。</p>
<p><code>connect</code> の返り値には Redux の Store の挙動をどのように React に割り当てるのか、という情報を持った関数が返ってくるため、それに <code>TodoContainer</code> を渡すことで React と Redux の世界をつなげている。</p>
<h3 id="開発にあたって">
  開発にあたって
  <a class="heading-link" href="#%e9%96%8b%e7%99%ba%e3%81%ab%e3%81%82%e3%81%9f%e3%81%a3%e3%81%a6">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>今回のチュートリアルでは使わなかったが、<a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi/related"  class="external-link" target="_blank" rel="noopener">ReactのDeveloper Tools</a>や<a href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd?hl=ja"  class="external-link" target="_blank" rel="noopener">ReduxのDeveloper Tools</a>が用意されている。Componentの構造やStoreの状態をChromeのDeveloper Toolsでできるようになる。</p>
<!-- textlint-disable ja-technical-writing/ja-no-weak-phrase -->
<p>それらを使いながら、このチュートリアルにDeleteやDoneの処理を追加すると理解が更に深まるかもしれない。</p>
<!-- textlint-enable -->

      </div>


      <footer>
        


        <div id="disqus_thread"></div>
<script>
  window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "nametake-dev" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
    
    document.addEventListener('themeChanged', function (e) { 
        if (document.readyState == 'complete') {
          DISQUS.reset({ reload: true, config: disqus_config });
        }
    });
</script>
        
        
        
        

        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2024
     nametake 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="../../../../../js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-ML7TD1LERR"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-ML7TD1LERR');
        }
      </script>
    
  



  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
